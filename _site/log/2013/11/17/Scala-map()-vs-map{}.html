<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Scala map() vs map{}</title>
  <meta name="description" content="I was wondering the other day what the difference really was, in Scala, between">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="http://www.johnmurray.io/log/2013/11/17/Scala-map()-vs-map%7B%7D.html">
  <link rel="alternate" type="application/rss+xml" title="John Murray" href="http://www.johnmurray.io/feed.xml" />
</head>


  <body>

    <header class="masthead">
  <div class="masthead-inner">
    <a href="/"><h1>murray</h2></a>
    <p class="sub">
      <a href="http://github.com/johnmurray">github</a>
      |
      <a href="http://twitter.com/johnmurray_io">twitter</a>
      |
      <a href="http://linkedin.com/pub/john-murray/22/a86/80a/en">linkedin</a>
    </p>
    <p class="sub">&copy; 2015. All Rights Reserved</p>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="post">

    <header class="post-header">
        <h1 class="post-title">Scala map() vs map{}</h1>
    </header>

    <article class="post-content">
        <p>I was wondering the other day what the difference really was, in Scala, between</p>

<div class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="lineno">1</span> <span class="k">val</span> <span class="n">list</span> <span class="k">=</span> <span class="nc">List</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">4</span><span class="o">)</span>
<span class="lineno">2</span> <span class="n">list</span><span class="o">.</span><span class="n">map</span><span class="o">(</span><span class="n">x</span> <span class="k">=&gt;</span> <span class="n">x</span> <span class="o">*</span> <span class="n">x</span><span class="o">)</span></code></pre></div>

<p>and</p>

<div class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="lineno">1</span> <span class="k">val</span> <span class="n">list</span> <span class="k">=</span> <span class="nc">List</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">4</span><span class="o">)</span>
<span class="lineno">2</span> <span class="n">list</span><span class="o">.</span><span class="n">map</span> <span class="o">{</span> <span class="n">x</span> <span class="k">=&gt;</span> <span class="n">x</span> <span class="o">*</span> <span class="n">x</span> <span class="o">}</span></code></pre></div>

<p>So, I figured I’d take a look at the map function defined on the List class. I winded up
finding the definition in the <code>TraversableLike</code> trait as follows:</p>

<div class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="lineno"> 1</span> <span class="k">def</span> <span class="n">map</span><span class="o">[</span><span class="kt">B</span>, <span class="kt">That</span><span class="o">](</span><span class="n">f</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=&gt;</span> <span class="n">B</span><span class="o">)(</span><span class="k">implicit</span> <span class="n">bf</span><span class="k">:</span> <span class="kt">CanBuildFrom</span><span class="o">[</span><span class="kt">Repr</span>, <span class="kt">B</span>, <span class="kt">That</span><span class="o">])</span><span class="k">:</span> <span class="kt">That</span> <span class="o">=</span> <span class="o">{</span>
<span class="lineno"> 2</span>   <span class="k">def</span> <span class="n">builder</span> <span class="k">=</span> <span class="o">{</span> <span class="c1">// extracted to keep method size under 35 bytes, so that it can be JIT-inlined</span>
<span class="lineno"> 3</span>     <span class="k">val</span> <span class="n">b</span> <span class="k">=</span> <span class="n">bf</span><span class="o">(</span><span class="n">repr</span><span class="o">)</span>
<span class="lineno"> 4</span>     <span class="n">b</span><span class="o">.</span><span class="n">sizeHint</span><span class="o">(</span><span class="k">this</span><span class="o">)</span>
<span class="lineno"> 5</span>     <span class="n">b</span>
<span class="lineno"> 6</span>   <span class="o">}</span>
<span class="lineno"> 7</span>   <span class="k">val</span> <span class="n">b</span> <span class="k">=</span> <span class="n">builder</span>
<span class="lineno"> 8</span>   <span class="k">for</span> <span class="o">(</span><span class="n">x</span> <span class="k">&lt;-</span> <span class="k">this</span><span class="o">)</span> <span class="n">b</span> <span class="o">+=</span> <span class="n">f</span><span class="o">(</span><span class="n">x</span><span class="o">)</span>
<span class="lineno"> 9</span>   <span class="n">b</span><span class="o">.</span><span class="n">result</span>
<span class="lineno">10</span> <span class="o">}</span></code></pre></div>

<p>Let’s ignore the builder for now since it’s the less important part of this question. We’re
interested in the first set of parameters, <code>f: A =&gt; B</code>. This seems to be a normal argument
yet we can apply it in two different ways. That got me thinking a little bit and so I decided
to play around a bit to see if I can figure this out anecdotally, before looking up the proper
literature.</p>

<h3 id="non-function-arguments">Non-Function Arguments</h3>

<p>I first wanted to try with some simple functions that didn’t have functions as arguments to see if
this format is generally applicable. I came up with some simple tests.</p>

<div class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="lineno"> 1</span> <span class="k">def</span> <span class="n">echo</span><span class="o">(</span><span class="n">x</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span> <span class="k">=</span> <span class="n">println</span><span class="o">(</span><span class="n">x</span><span class="o">)</span>
<span class="lineno"> 2</span>  
<span class="lineno"> 3</span> <span class="n">echo</span><span class="o">{</span><span class="s">&quot;hello&quot;</span><span class="o">}</span>    <span class="c1">// valid</span>
<span class="lineno"> 4</span> <span class="n">echo</span><span class="o">(</span><span class="s">&quot;hello&quot;</span><span class="o">)</span>    <span class="c1">// valid</span>
<span class="lineno"> 5</span>  
<span class="lineno"> 6</span>  
<span class="lineno"> 7</span> <span class="k">def</span> <span class="n">echoName</span><span class="o">(</span><span class="n">name</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">x</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span> <span class="k">=</span> <span class="n">println</span><span class="o">(</span><span class="s">&quot;$name: $x&quot;</span><span class="o">)</span>
<span class="lineno"> 8</span>  
<span class="lineno"> 9</span> <span class="n">echoName</span><span class="o">{</span><span class="s">&quot;John&quot;</span><span class="o">,</span> <span class="s">&quot;hello&quot;</span><span class="o">}</span>        <span class="c1">// invalid</span>
<span class="lineno">10</span> <span class="n">echoName</span><span class="o">(</span><span class="s">&quot;John&quot;</span><span class="o">,</span> <span class="s">&quot;hello&quot;</span><span class="o">)</span>        <span class="c1">// valid</span>
<span class="lineno">11</span> <span class="n">echoName</span><span class="o">({</span><span class="s">&quot;John&quot;</span><span class="o">},</span> <span class="o">{</span><span class="s">&quot;hello&quot;</span><span class="o">})</span>    <span class="c1">// valid</span></code></pre></div>

<p>So from this it seems to indicate that braces are not interchangeable with parenthesis. However,
it does seem that <code>"John"</code> and <code>{"John"}</code> are interchangeable. In fact, if we look at the REPL
we see:</p>

<div class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="lineno">1</span> <span class="k">val</span> <span class="n">s1</span> <span class="k">=</span> <span class="o">{</span><span class="s">&quot;hello&quot;</span><span class="o">}</span>     <span class="c1">// s1: String = hello</span>
<span class="lineno">2</span> <span class="k">val</span> <span class="n">s</span> <span class="k">=</span> <span class="s">&quot;hello&quot;</span>        <span class="c1">// s: String = hello</span></code></pre></div>

<p>This may not be a surprise to some, but that means that something like <code>echo {"hello"}</code> can
really just be thought of as a shorthand for <code>echo({"hello"})</code>. But what about <code>{x =&gt; x * x}</code>.
We can assume that just returns a function, correct? So that would means we can assume that
these are functionally equivalent:</p>

<div class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="lineno">1</span> <span class="k">val</span> <span class="n">list</span> <span class="k">=</span> <span class="nc">List</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">4</span><span class="o">)</span>
<span class="lineno">2</span> <span class="n">list</span><span class="o">.</span><span class="n">map</span><span class="o">(</span><span class="n">x</span> <span class="k">=&gt;</span> <span class="n">x</span> <span class="o">*</span> <span class="n">x</span><span class="o">)</span>
<span class="lineno">3</span> <span class="n">list</span><span class="o">.</span><span class="n">map</span><span class="o">({</span><span class="n">x</span> <span class="k">=&gt;</span> <span class="n">x</span> <span class="o">*</span> <span class="n">x</span><span class="o">})</span></code></pre></div>

<p>And, anecdotally, this seems to be true.</p>

<h3 id="back-to-functions">Back to Functions</h3>

<p>So based on our findings, what is the point of the curly braces and when would they be useful.
Let’s do some experiments with a little more meat and see if we can find an answer. First let’s try
a slightly larger map example.</p>

<div class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="lineno"> 1</span> <span class="k">val</span> <span class="n">list</span> <span class="k">=</span> <span class="nc">List</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">4</span><span class="o">)</span>
<span class="lineno"> 2</span>  
<span class="lineno"> 3</span> <span class="c1">// not valid (compile-error)</span>
<span class="lineno"> 4</span> <span class="n">list</span><span class="o">.</span><span class="n">map</span><span class="o">(</span><span class="n">x</span> <span class="k">=&gt;</span>
<span class="lineno"> 5</span>   <span class="k">val</span> <span class="n">y</span> <span class="k">=</span> <span class="n">x</span> <span class="o">*</span> <span class="n">x</span>
<span class="lineno"> 6</span>   <span class="k">val</span> <span class="n">z</span> <span class="k">=</span> <span class="n">y</span> <span class="o">*</span> <span class="n">x</span>
<span class="lineno"> 7</span>   <span class="nc">Math</span><span class="o">.</span><span class="n">sin</span><span class="o">(</span><span class="n">z</span> <span class="o">/</span> <span class="n">x</span><span class="o">)</span>
<span class="lineno"> 8</span> <span class="o">)</span>
<span class="lineno"> 9</span>  
<span class="lineno">10</span> <span class="c1">// valid</span>
<span class="lineno">11</span> <span class="n">list</span><span class="o">.</span><span class="n">map</span><span class="o">{</span><span class="n">x</span> <span class="k">=&gt;</span>
<span class="lineno">12</span>   <span class="k">val</span> <span class="n">y</span> <span class="k">=</span> <span class="n">x</span> <span class="o">*</span> <span class="n">x</span>
<span class="lineno">13</span>   <span class="k">val</span> <span class="n">z</span> <span class="k">=</span> <span class="n">y</span> <span class="o">*</span> <span class="n">x</span>
<span class="lineno">14</span>   <span class="nc">Math</span><span class="o">.</span><span class="n">sin</span><span class="o">(</span><span class="n">z</span> <span class="o">/</span> <span class="n">x</span><span class="o">)</span>
<span class="lineno">15</span> <span class="o">}</span></code></pre></div>

<p>Ah ha, so there is a good reason to use curly braces. It looks like the parenthesis version cannot
handle multiple statements and is only expecting a single expression. Furthermore, I found this bit
interesting as well:</p>

<div class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="lineno">1</span> <span class="k">val</span> <span class="n">f1</span> <span class="k">=</span> <span class="o">(</span><span class="n">x</span> <span class="k">:</span> <span class="kt">Int</span> <span class="o">=&gt;</span> <span class="n">x</span> <span class="o">*</span> <span class="n">x</span><span class="o">)</span>    <span class="c1">// invalid - compiler error (can&#39;t resolve x)</span>
<span class="lineno">2</span> <span class="k">val</span> <span class="n">f2</span> <span class="k">=</span> <span class="o">(</span><span class="n">x</span> <span class="k">:</span> <span class="kt">Int</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">x</span> <span class="o">*</span> <span class="n">x</span>    <span class="c1">// valid</span>
<span class="lineno">3</span> <span class="k">val</span> <span class="n">f3</span> <span class="k">=</span> <span class="o">{</span><span class="n">x</span> <span class="k">:</span> <span class="kt">Int</span> <span class="o">=&gt;</span> <span class="n">x</span> <span class="o">*</span> <span class="n">x</span><span class="o">}</span>    <span class="c1">// valid</span></code></pre></div>

<p>The same syntax using parenthesis cannot be used to define the function outside of the map unlike
the version with curly-braces. Very interesting.</p>

<h3 id="the-real-story">The Real Story</h3>

<p>Okay, at this point I feel like I’ve made some interesting findings, but I’m curious what the
Internet has to say about such things. So I figured I’d let her weigh in. I came across a few
different posts:</p>

<ul>
  <li><a href="http://www.scala-lang.org/old/node/2593">Scala Forums Posting, complete with appearance by Odersky</a></li>
  <li><a href="http://stackoverflow.com/questions/4386127/what-is-the-formal-difference-in-scala-between-braces-and-parentheses-and-when">This SO Post</a></li>
  <li><a href="http://www.scala-lang.org/old/node/10195">Another Scala Forums Posting</a></li>
</ul>

<p>Surprisingly, all three answers were by the same person. For someone strapped for time when it
comes to blogging, he sure does seem to make a lot of appearances on this topic. ;-D</p>

<p>All in all, there seems to be quite a bit of discussion with some grey areas still that I still
don’t fully understand. In those cases the compiler seems to be the specification, which is never
preferable (IMO) for many reasons. Oh Scala, you are an interesting little language.</p>



        <div class="footer-navigation">
            
                <span class="previous"><a href="/log/2013/11/17/Read-Less-HN.html">
                    &laquo;Read Less HN
                </a></span>
            
            
                <span class="next"><a href="/log/2014/04/15/Starting-a-Scala-Project.html">
                    Starting a Scala Project&raquo;
                </a></span>
            
        </div>

        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <!-- Footer Advertisement -->
        <ins class="adsbygoogle"
             style="display:block"
             data-ad-client="ca-pub-8460014050417630"
             data-ad-slot="9924998708"
             data-ad-format="auto"></ins>
        <script>
        (adsbygoogle = window.adsbygoogle || []).push({});
        </script>

    </article>

</div>

      </div>
    </div>


    <!-- Google Analytics -->
    <script type="application/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-11511983-4']);
      _gaq.push(['_trackPageview']);
      (function() {
        var ga = document.createElement('script'); 
        ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'stats.g.doubleclick.net/dc.js';
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(ga, s);
      })();
    </script>
  </body>

</html>
