<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Per-Project Console</title>
  <meta name="description" content="Pry is a wonderful interactive environment for Ruby. It is (more or less)a replacement to IRB. We already know that interactive environments are highlyuseful...">

  <!-- <link rel="stylesheet" href="/css/main.css"> -->
  
  <style>
    @import "https://fonts.googleapis.com/css?family=Roboto:300,400,500";body,h1,h2,h3,h4,h5,h6,p,blockquote,pre,hr,dl,dd,ol,ul,figure{margin:0;padding:0}body{-webkit-text-size-adjust:100%;background-color:#fff;color:#566b78;font-family:"Roboto","Open Sans",Helvetica,Arial,sans-serif;font-size:18px;font-weight:300;line-height:1.7;padding-top:2em}h1,h2,strong{color:#344b78}h1,h2,h3,h4,h5,h6,p,blockquote,pre,ul,ol,dl,figure{margin-bottom:15px}img{margin-bottom:20px;max-width:100%;vertical-align:middle}figure>img{display:block}figcaption{font-size:15.75px}ul,ol{margin-left:30px}li>ul,li>ol{margin-bottom:0}h1,h2,h3,h4,h5,h6{font-weight:300}a{color:#e81c4f;text-decoration:none}a:visited{color:#e81c4f}a:hover{color:#566b78;text-decoration:none}blockquote{color:#828282;border-left:4px solid #e8e8e8;padding-left:15px;font-size:18px;letter-spacing:-1px;font-style:italic}blockquote>:last-child{margin-bottom:0}pre,code{font-size:12px;border-radius:3px;border:1px solid #d8dee9;background-color:#f5f7f9}code{padding:4px 5px 1px 5px}pre{padding:8px 12px;overflow-x:auto}pre>code{border:0;padding-right:0;padding-left:0}.wrapper{max-width:-webkit-calc(800px - (30px * 2));max-width:calc(800px - (30px * 2));margin-right:auto;margin-left:auto;padding-right:30px;padding-left:30px}@media screen and (max-width: 800px){.wrapper{max-width:-webkit-calc(800px - (30px));max-width:calc(800px - (30px));padding-right:15px;padding-left:15px}}.wrapper:after{content:"";display:table;clear:both}.icon>svg{display:inline-block;width:16px;height:16px;vertical-align:middle}.icon>svg path{fill:#828282}.masthead{color:#fff;background-color:#2a2a2a;min-width:270px}.masthead h1{color:#fff;font-weight:400;font-family:"Roboto", "Lucida Console", Monaco, monospace}.masthead a{text-decoration:none}.masthead a:hover{text-decoration:none}.masthead a:active{text-decoration:none}.masthead-inner .sub{color:#666}.masthead-inner .sub a{color:#666}.masthead-inner .sub a:hover{color:#999}@media (min-width: 760px){.masthead-inner{padding:40px}.page-content{margin-left:40px;margin-right:40px}}@media (min-width: 990px){.masthead{position:fixed;top:0;left:0;bottom:0;width:25%;margin-bottom:0}.masthead-inner{position:absolute;top:0;right:0;left:0}.masthead h1{font-size:54px}.page-content{margin-left:35%;margin-right:10%;width:55%}}.page-content{padding:30px 0}.page-heading{font-size:20px}.post-list{margin-left:0;list-style:none}.post-list .post-title{margin-top:30px;margin-bottom:0;display:inline-block}.post-meta{color:#828282;display:inline-block;float:right;font-size:15.75px;margin-top:32px}.post-link{display:block;font-size:24px}.post-header{margin-bottom:30px}.post-title{font-size:42px;letter-spacing:-1px;line-height:1}@media screen and (max-width: 800px){.post-title{font-size:36px}}.post-content{margin-bottom:30px}.post-content h2{font-size:32px}@media screen and (max-width: 800px){.post-content h2{font-size:28px}}.post-content h3{font-size:26px}@media screen and (max-width: 800px){.post-content h3{font-size:22px}}.post-content h4{font-size:20px}@media screen and (max-width: 800px){.post-content h4{font-size:18px}}.footer-navigation{border-bottom:1px solid #e0e0e0;display:block;font-weight:bold;height:60px;margin:50px 0 40px 0;text-align:center}.footer-navigation .previous{display:block;margin:0 auto}.footer-navigation .next{display:block;margin:0 auto}@media (min-width: 760px){.footer-navigation{height:30px;padding-bottom:10px}.footer-navigation .previous{display:block;float:left;margin:0;text-align:left}.footer-navigation .next{display:block;float:right;margin:0;text-align:right}}.highlight{background:#ffffff;margin-bottom:20px;margin-top:20px}.highlight .c{color:#999988;font-style:italic}.highlight .err{color:#a61717;background-color:#e3d2d2}.highlight .k{font-weight:bold}.highlight .o{font-weight:bold}.highlight .cm{color:#999988;font-style:italic}.highlight .cp{color:#999999;font-weight:bold}.highlight .c1{color:#999988;font-style:italic}.highlight .cs{color:#999999;font-weight:bold;font-style:italic}.highlight .gd{color:#000000;background-color:#fdd}.highlight .gd .x{color:#000000;background-color:#faa}.highlight .ge{font-style:italic}.highlight .gr{color:#a00}.highlight .gh{color:#999}.highlight .gi{color:#000000;background-color:#dfd}.highlight .gi .x{color:#000000;background-color:#afa}.highlight .go{color:#888}.highlight .gp{color:#555}.highlight .gs{font-weight:bold}.highlight .gu{color:#aaa}.highlight .gt{color:#a00}.highlight .kc{font-weight:bold}.highlight .kd{font-weight:bold}.highlight .kp{font-weight:bold}.highlight .kr{font-weight:bold}.highlight .kt{color:#445588;font-weight:bold}.highlight .m{color:#099}.highlight .s{color:#d14}.highlight .na{color:teal}.highlight .nb{color:#0086B3}.highlight .nc{color:#445588;font-weight:bold}.highlight .no{color:#0086b3}.highlight .ni{color:purple}.highlight .ne{color:#990000;font-weight:bold}.highlight .nf{color:#990000;font-weight:bold}.highlight .nn{color:#555}.highlight .nt{color:navy}.highlight .nv{color:teal}.highlight .ow{font-weight:bold}.highlight .w{color:#bbb}.highlight .mf{color:#099}.highlight .mh{color:#099}.highlight .mi{color:#099}.highlight .mo{color:#099}.highlight .sb{color:#d14}.highlight .sc{color:#d14}.highlight .sd{color:#d14}.highlight .s2{color:#d14}.highlight .se{color:#d14}.highlight .sh{color:#d14}.highlight .si{color:#0086b3}.highlight .sx{color:#d14}.highlight .sr{color:#009926}.highlight .s1{color:#d14}.highlight .ss{color:#0086b3}.highlight .bp{color:#999}.highlight .vc{color:teal}.highlight .vg{color:teal}.highlight .vi{color:teal}.highlight .il{color:#099}figure .highlight{border-left:3px solid #e0e0e0}.post .highlight .lineno{color:#ccc;display:inline-block;padding:0 5px 0 0;border-right:1px solid #ccc}.post .highlight pre code{display:block;white-space:pre;overflow-x:auto;word-wrap:normal}.post .highlight pre{border:none;margin:0}.post .highlight pre code{background-color:transparent;font-size:12px}

  </style>
  <link rel="canonical" href="http://www.johnmurray.io/log/2012/05/31/Per-Project-Console.html">
  <link rel="alternate" type="application/rss+xml" title="John Murray" href="http://www.johnmurray.io/feed.xml" />
</head>


  <body>

    <header class="masthead">
  <div class="masthead-inner">
    <a href="/"><h1>murray</h2></a>
    <p class="sub">
      <a href="http://github.com/johnmurray">github</a>
      |
      <a href="http://twitter.com/johnmurray_io">twitter</a>
      |
      <a href="http://linkedin.com/pub/john-murray/22/a86/80a/en">linkedin</a>
    </p>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="post">

    <header class="post-header">
        <h1 class="post-title">Per-Project Console</h1>
    </header>

    <article class="post-content">
        <p><a href="http://pry.github.com/">Pry</a> is a wonderful interactive environment for Ruby. It is (more or less)
a replacement to IRB. We already know that interactive environments are highly
useful and the Rails Console is a great example of utilizing that interactive
environment effectively.</p>

<p>However, if you’re like me, then you don’t work in Rails. The majority of my
work is in custom Ruby programs, <a href="http://rubyeventmachine.com/">EM</a>-driven programs and <a href="http://www.sinatrarb.com/">Sinatra</a> APIs.
You don’t get anything like Rails Console for free when you’re building a custom
Ruby program. So, when you start up an interactive environment, you may find
yourself starting each session like so:</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre></td><td class="code"><pre><span class="nx">require</span> <span class="s1">'bundler/setup'</span>
<span class="nx">bundler</span><span class="p">.</span><span class="nx">require</span><span class="p">(:</span><span class="nx">development</span><span class="p">,</span> <span class="p">:</span><span class="nx">test</span><span class="p">,</span> <span class="p">:</span><span class="nx">console</span><span class="p">)</span>
 
<span class="nx">$</span><span class="p">:</span> <span class="o">&lt;&lt;</span> <span class="nx">File</span><span class="p">.</span><span class="nx">expand_path</span><span class="p">(</span><span class="s1">'../src'</span><span class="p">,</span> <span class="nx">__FILE__</span><span class="p">)</span>
<span class="nx">require</span> <span class="s1">'app'</span>
<span class="nx">require</span> <span class="s1">'models/user_account'</span>
<span class="nx">require</span> <span class="s1">'models/cat'</span>
 
<span class="err">#</span> <span class="nx">Load</span> <span class="nx">config</span> <span class="nx">and</span> <span class="nx">connect</span> <span class="nx">to</span> <span class="nx">DB</span>
<span class="nx">App</span><span class="p">.</span><span class="nx">init</span><span class="p">()</span>
 
<span class="nx">def</span> <span class="nx">random_helper_method</span>
  <span class="err">#</span> <span class="p">...</span> <span class="nx">helpful</span> <span class="nx">code</span> <span class="p">...</span>
<span class="nx">end</span>
 
<span class="err">#</span> <span class="nx">maybe</span> <span class="nx">some</span> <span class="nx">other</span> <span class="nx">random</span> <span class="nx">junk</span> <span class="nx">depending</span> 
<span class="err">#</span> <span class="nx">on</span> <span class="nx">what</span> <span class="nx">your</span> <span class="nx">testing</span> <span class="nx">at</span> <span class="nx">the</span> <span class="nx">moment</span>
 
 
<span class="err">#</span> <span class="nx">FINALLY</span> <span class="nx">time</span> <span class="nx">to</span> <span class="nx">test</span><span class="o">!</span></pre></td></tr></tbody></table></code></pre></figure>

<p>You may keep your console running just because you don’t want to have to type
all of that junk again. But eventually you will restart your computer, close
your terminal, etc. and you will loose all of the work you put into setting up
your console environment.</p>

<p>My question to you (and to myself), is why go through all this trouble when
creating your own console is so easy! Just create a <strong>console</strong> file in the
root of your project and insert all of that code that you would normally put
into an interactive session. You can even get fancy with a little color output
and various, generic helper methods that are useful for debugging. A console
example from one of my [current projects] looks like the following:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
</pre></td><td class="code"><pre><span class="c1">#!/usr/bin/env ruby</span>
 
<span class="c1"># require all the necessary files</span>
<span class="vg">$:</span> <span class="o">&lt;&lt;</span> <span class="o">::</span><span class="no">File</span><span class="p">.</span><span class="nf">expand_path</span><span class="p">(</span><span class="s1">'../src'</span><span class="p">,</span> <span class="kp">__FILE__</span><span class="p">)</span>
<span class="nb">require</span> <span class="s1">'app'</span>
<span class="nb">require</span> <span class="s1">'geofence'</span>
 
<span class="c1"># at this point bundler should be setup and the :development group</span>
<span class="c1"># should have been included. However, just to be sure, I'm going to</span>
<span class="c1"># include bundler again and require the console group.</span>
<span class="nb">require</span> <span class="s1">'bundler/setup'</span>
<span class="no">Bundler</span><span class="p">.</span><span class="nf">require</span><span class="p">(</span><span class="ss">:console</span><span class="p">)</span>
 
<span class="c1"># specify some sample fences to play with</span>
<span class="c1"># </span>
<span class="c1"># format:</span>
<span class="c1">#   [</span>
<span class="c1">#     [:lon, :lat],</span>
<span class="c1">#     ...</span>
<span class="c1">#   ]</span>
<span class="n">fence_1</span> <span class="o">=</span> <span class="p">[</span>
  <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
  <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
  <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
  <span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
  <span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span>
  <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">],</span>
  <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>
  <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
  <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="p">]</span>
 
<span class="n">fence_2</span> <span class="o">=</span> <span class="p">[</span>
  <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>
  <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>
  <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
  <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
  <span class="p">[</span><span class="mi">12</span><span class="p">,</span> <span class="mi">7</span><span class="p">],</span>
  <span class="p">[</span><span class="mi">12</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span>
  <span class="p">[</span><span class="mi">15</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span>
  <span class="p">[</span><span class="mi">15</span><span class="p">,</span> <span class="mi">15</span><span class="p">],</span>
  <span class="p">[</span><span class="mi">12</span><span class="p">,</span> <span class="mi">15</span><span class="p">],</span>
  <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">18</span><span class="p">],</span>
  <span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">15</span><span class="p">],</span>
  <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">15</span><span class="p">],</span>
  <span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">13</span><span class="p">],</span>
  <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span>
<span class="p">]</span>
 
<span class="c1"># patch pretty-print to use a smaller width for looking at our fences</span>
<span class="k">class</span> <span class="nc">PP</span>
  <span class="k">class</span> <span class="o">&lt;&lt;</span> <span class="nb">self</span>
    <span class="kp">alias_method</span> <span class="ss">:old_pp</span><span class="p">,</span> <span class="ss">:pp</span>
    <span class="k">def</span> <span class="nf">pp</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">out</span> <span class="o">=</span> <span class="vg">$&gt;</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="mi">40</span><span class="p">)</span>
      <span class="n">old_pp</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
 
 
<span class="c1"># include helpers to play around with Sinatra application</span>
<span class="kp">include</span> <span class="no">Rack</span><span class="o">::</span><span class="no">Test</span><span class="o">::</span><span class="no">Methods</span>
<span class="nb">self</span><span class="p">.</span><span class="nf">instance_eval</span> <span class="k">do</span>
  <span class="vi">@app</span> <span class="o">=</span> <span class="no">App</span><span class="p">.</span><span class="nf">new</span>
  <span class="k">def</span> <span class="nf">app</span><span class="p">;</span> <span class="vi">@app</span><span class="p">;</span> <span class="k">end</span>
<span class="k">end</span>
 
 
<span class="c1"># add ability to reload console</span>
<span class="k">def</span> <span class="nf">reload</span>
  <span class="n">reload_msg</span> <span class="o">=</span> <span class="s1">'# Reloading the console...'</span>
  <span class="nb">puts</span> <span class="no">CodeRay</span><span class="p">.</span><span class="nf">scan</span><span class="p">(</span><span class="n">reload_msg</span><span class="p">,</span> <span class="ss">:ruby</span><span class="p">).</span><span class="nf">term</span>
  <span class="no">Pry</span><span class="p">.</span><span class="nf">save_history</span>
  <span class="nb">exec</span><span class="p">(</span><span class="s1">'./console'</span><span class="p">)</span>
<span class="k">end</span>
 
<span class="n">g</span> <span class="o">=</span> <span class="no">Class</span><span class="p">.</span><span class="nf">new</span> <span class="p">{</span>
  <span class="k">def</span> <span class="nf">method_missing</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">block</span><span class="p">)</span>
    <span class="no">Geofence</span><span class="p">.</span><span class="nf">send</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">block</span><span class="p">)</span>
  <span class="k">end</span>
<span class="p">}.</span><span class="nf">new</span>
 
 
<span class="c1"># start the console! :-)</span>
<span class="nb">system</span><span class="p">(</span><span class="s1">'clear'</span><span class="p">)</span>
<span class="n">welcome</span> <span class="o">=</span> <span class="o">&lt;&lt;</span><span class="no">eos</span><span class="sh">
# This is my interactive playground. You can call the Sinatra methods in
# the same way you would in RSpec (get, post). There are also a couple of
# test fences defined for you (fence_1, fence_2). I also monkey-patched
# 'pp' to print short arrays nicer.
#
# Everything you would want to play with (for this project) should be in here
# 
</span><span class="no">eos</span>
<span class="nb">puts</span> <span class="no">CodeRay</span><span class="p">.</span><span class="nf">scan</span><span class="p">(</span><span class="n">welcome</span><span class="p">,</span> <span class="ss">:ruby</span><span class="p">).</span><span class="nf">term</span>
<span class="no">Pry</span><span class="p">.</span><span class="nf">start</span></pre></td></tr></tbody></table></code></pre></figure>

<p>In my console I:</p>

<ul>
  <li>Load my project files</li>
  <li>Define test-data to work with</li>
  <li>redefine <strong>PP.pp</strong> to use a shorter-width for printing out test-coordinates</li>
  <li>load Rack helper methods so that I can make calls to my Sinatra app from
within the console</li>
  <li>add the ability to reload my console</li>
  <li>define a helper object to call private methods on the Geofence class</li>
  <li>print a nice welcome message (colorized with CodeRay which is packaged with
Pry)</li>
</ul>

<p>That’s quite a bit of work if I were to do that each time I started a new
interactive Pry session. And to be honest, I just wouldn’t. I would do the bare
minimum required to test something. With the console, I can have some other
niceties because I only have to write them once. So nice!</p>

<p>This has now become a mandatory step when <em>getting started</em> on any new Ruby
project. I add some basics that I put into all of my console files and then
I evolve the console as the project moves forward. I can’t imagine working
any other way (well… I can, I just don’t prefer it).</p>



        <div class="footer-navigation">
            
                <span class="previous"><a href="/log/2012/04/19/New-Web-Frameworks.html">
                    &laquo;New Web Frameworks
                </a></span>
            
            
                <span class="next"><a href="/log/2012/07/11/Geofencing-Part-1.html">
                    Geofencing - Part 1&raquo;
                </a></span>
            
        </div>
    </article>

    <footer style="text-align:center;">
      &copy; 2017. All Rights Reserved
    </footer>

</div>

      </div>
    </div>


    <!-- Google Analytics -->
    <script type="application/javascript">
      function downloadGoogleAnalytics() {
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-11511983-4']);
        _gaq.push(['_trackPageview']);
        (function() {
          var ga = document.createElement('script'); 
          ga.type = 'text/javascript'; ga.async = true;
          ga.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'stats.g.doubleclick.net/dc.js';
          var s = document.getElementsByTagName('script')[0];
          s.parentNode.insertBefore(ga, s);
        })();
      }
			if (window.addEventListener) window.addEventListener("load", downloadGoogleAnalytics, false);
			else if (window.attachEvent) window.attachEvent("onload", downloadGoogleAnalytics);
			else                         window.onload = downloadGoogleAnalytics;
    </script>
  </body>

</html>
