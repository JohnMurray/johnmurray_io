<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>API Anti-Patterns</title>
  <meta name="description" content="There’s a lot we can learn from Microsoft, some of it from well designedsoftware and most some of it from poorly designed software. This particular post is a...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="http://www.johnmurray.io/log/2012/06/03/API-Anti-Patterns.html">
  <link rel="alternate" type="application/rss+xml" title="John Murray" href="http://www.johnmurray.io/feed.xml" />
</head>


  <body>

    <header class="masthead">
  <div class="masthead-inner">
    <a href="/"><h1>murray</h2></a>
    <p class="sub">
      <a href="http://github.com/johnmurray">github</a>
      |
      <a href="http://twitter.com/johnmurray_io">twitter</a>
      |
      <a href="http://linkedin.com/pub/john-murray/22/a86/80a/en">linkedin</a>
    </p>
    <p class="sub">&copy; 2015. All Rights Reserved</p>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="post">

  <header class="post-header">
    <h1 class="post-title">API Anti-Patterns</h1>
  </header>

  <article class="post-content">
    <p>There’s a lot we can learn from Microsoft, some of it from well designed
software and <s>most</s> some of it from poorly designed software. 
This particular post is about the latter. </p>

<p>I was working in .NET today (yes, it was a sad day) and I needed to do the
following:</p>

<ul>
  <li>Serialize an object to valid JSON</li>
  <li>Send that JSON to a HTTP service via an HTTP POST</li>
  <li>Verify the response (200 status code)</li>
</ul>

<p>Sounds fairly simple. In Ruby, it looks something like this:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="lineno">1</span> <span class="n">uri</span> <span class="o">=</span> <span class="no">URI</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s1">&#39;http://localhost:4567&#39;</span><span class="p">)</span>
<span class="lineno">2</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="n">uri</span><span class="o">.</span><span class="n">host</span><span class="p">,</span> <span class="n">uri</span><span class="o">.</span><span class="n">port</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">http</span><span class="o">|</span>
<span class="lineno">3</span>   <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">:</span> <span class="s1">&#39;application/json&#39;</span><span class="p">}</span>
<span class="lineno">4</span>   <span class="n">http</span><span class="o">.</span><span class="n">post2</span><span class="p">(</span><span class="s1">&#39;/service_path&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">to_json</span><span class="p">,</span> <span class="n">headers</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">resp</span><span class="o">|</span>
<span class="lineno">5</span>     <span class="k">return</span> <span class="n">resp</span><span class="o">.</span><span class="n">code</span> <span class="o">==</span> <span class="s1">&#39;200&#39;</span>
<span class="lineno">6</span>   <span class="k">end</span>
<span class="lineno">7</span> <span class="k">end</span></code></pre></div>

<p>I would expect the .NET version to be fairly similar (but longer of course).
However, I was a little off in my assumptions. Let me walk you through the
steps I took just to get the same functionality in the Ruby code above. As
we go along, I’ll point out the anti-patterns found in the .NET standard lib.</p>

<h4 id="step-1---defining-a-data-contract">Step 1 - Defining a Data Contract</h4>

<div class="highlight"><pre><code class="language-c#" data-lang="c#"><span class="lineno"> 1</span> <span class="na">[DataContract]</span>
<span class="lineno"> 2</span> <span class="k">public</span> <span class="k">class</span> <span class="nc">MyObjectDataContract</span>
<span class="lineno"> 3</span> <span class="p">{</span>
<span class="lineno"> 4</span> <span class="na">    [DataMember(Name = &quot;user_id&quot;)]</span>
<span class="lineno"> 5</span>     <span class="k">public</span> <span class="kt">int?</span> <span class="n">UserId</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
<span class="lineno"> 6</span> <span class="na"> </span>
<span class="lineno"> 7</span> <span class="na">    [DataMember(Name = &quot;car_id&quot;)]</span>
<span class="lineno"> 8</span>     <span class="k">public</span> <span class="kt">int?</span> <span class="n">CarId</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
<span class="lineno"> 9</span> <span class="na"> </span>
<span class="lineno">10</span> <span class="na">    [DataMember(Name = &quot;template_data&quot;)]</span>
<span class="lineno">11</span>     <span class="k">public</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="n">String</span><span class="p">,</span> <span class="kt">object</span><span class="p">&gt;</span> <span class="n">TemplateData</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
<span class="lineno">12</span> <span class="na"> </span>
<span class="lineno">13</span> <span class="na">    [DataMember(Name = &quot;key&quot;)]</span>
<span class="lineno">14</span>     <span class="k">public</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="n">String</span><span class="p">,</span> <span class="kt">object</span><span class="p">&gt;</span> <span class="n">Key</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
<span class="lineno">15</span> <span class="p">}</span></code></pre></div>

<p>Nothing out of the ordinary here. Everything seems to be going well so far. I’ve
defined my basic object that I would like to serialize to JSON and life is
peachy.</p>

<h4 id="step-2---serialize-the-json">Step 2 - Serialize the JSON</h4>
<p>Based on what I found on the internet, this should suffice:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="lineno">1</span> <span class="sr">//</span> <span class="n">assume</span> <span class="n">myObjectDataContract</span> <span class="n">is</span> <span class="n">already</span> <span class="n">set</span> <span class="ow">and</span> <span class="n">defined</span>
<span class="lineno">2</span>  
<span class="lineno">3</span> <span class="no">MemoryStream</span> <span class="n">jsonStream</span> <span class="o">=</span> <span class="kp">new</span> <span class="no">MemoryStream</span><span class="p">();</span>
<span class="lineno">4</span> <span class="no">DataContractJsonSerializer</span> <span class="n">ser</span> <span class="o">=</span> <span class="kp">new</span> <span class="no">DataContractJsonSerializer</span><span class="p">(</span>
<span class="lineno">5</span>     <span class="n">typeof</span><span class="p">(</span><span class="no">MyObjectDataContract</span><span class="p">));</span>
<span class="lineno">6</span> <span class="n">ser</span><span class="o">.</span><span class="n">WriteObject</span><span class="p">(</span><span class="n">jsonStream</span><span class="p">,</span> <span class="n">myObjectDataContract</span><span class="p">);</span></code></pre></div>

<p><br /></p>

<p><strong><em>Anit-Pattern #1</em></strong> - Organize your standard library in a way that makes no
logical sense</p>

<p>I had to include the <em>System.XML</em> DLL into my project
for this to work for searializing to JSON?? (VS reported the error on line 6
in the example above.) This is an aweful orginization of the standard lib. Why
do I need to include <em>System.XML</em> in order to use the JSON serializer?!?!?</p>

<p><br />
<em>Deep breath… Okay, let’s continue.</em></p>

<p><br /></p>

<p>I used built-in data structures so that the serialization would/should work
properly. After all, they are part of the standard lib! So, I would expect the
serialized JSON of my data contract to look like:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="lineno"> 1</span> <span class="p">{</span>
<span class="lineno"> 2</span>   <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
<span class="lineno"> 3</span>   <span class="s2">&quot;car_id&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
<span class="lineno"> 4</span>   <span class="s2">&quot;template_data&quot;</span><span class="p">:</span> <span class="p">{</span>
<span class="lineno"> 5</span>     <span class="s2">&quot;key1&quot;</span><span class="p">:</span> <span class="s2">&quot;value1&quot;</span><span class="p">,</span>
<span class="lineno"> 6</span>     <span class="s2">&quot;key2&quot;</span><span class="p">:</span> <span class="s2">&quot;value2&quot;</span><span class="p">,</span>
<span class="lineno"> 7</span>     <span class="s2">&quot;key3&quot;</span><span class="p">:</span> <span class="s2">&quot;value3&quot;</span>
<span class="lineno"> 8</span>   <span class="p">},</span>
<span class="lineno"> 9</span>   <span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="p">{</span>
<span class="lineno">10</span>     <span class="s2">&quot;key1&quot;</span><span class="p">:</span> <span class="s2">&quot;value1&quot;</span><span class="p">,</span>
<span class="lineno">11</span>     <span class="s2">&quot;key2&quot;</span><span class="p">:</span> <span class="s2">&quot;value2&quot;</span>
<span class="lineno">12</span>   <span class="p">}</span>
<span class="lineno">13</span> <span class="p">}</span></code></pre></div>

<p><br /></p>

<p><strong><em>Anti-Patern #2</em></strong> - Write code that doesn’t follow standards or user-expectations</p>

<p>Nope, instead the JSON comes out looking like this:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="lineno"> 1</span> <span class="p">{</span>
<span class="lineno"> 2</span>   <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
<span class="lineno"> 3</span>   <span class="s2">&quot;car_id&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
<span class="lineno"> 4</span>   <span class="s2">&quot;template_data&quot;</span><span class="p">:</span> <span class="o">[</span>
<span class="lineno"> 5</span>     <span class="p">{</span><span class="s2">&quot;Key&quot;</span><span class="p">:</span> <span class="s2">&quot;key1&quot;</span><span class="p">,</span> <span class="s2">&quot;Value&quot;</span><span class="p">:</span> <span class="s2">&quot;value1&quot;</span><span class="p">},</span>
<span class="lineno"> 6</span>     <span class="p">{</span><span class="s2">&quot;Key&quot;</span><span class="p">:</span> <span class="s2">&quot;key2&quot;</span><span class="p">,</span> <span class="s2">&quot;Value&quot;</span><span class="p">:</span> <span class="s2">&quot;value2&quot;</span><span class="p">},</span>
<span class="lineno"> 7</span>     <span class="p">{</span><span class="s2">&quot;Key&quot;</span><span class="p">:</span> <span class="s2">&quot;key3&quot;</span><span class="p">,</span> <span class="s2">&quot;Value&quot;</span><span class="p">:</span> <span class="s2">&quot;value3&quot;</span><span class="p">}</span>
<span class="lineno"> 8</span>   <span class="o">]</span><span class="p">,</span>
<span class="lineno"> 9</span>   <span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="o">[</span>
<span class="lineno">10</span>     <span class="p">{</span><span class="s2">&quot;Key&quot;</span><span class="p">:</span> <span class="s2">&quot;key1&quot;</span><span class="p">,</span> <span class="s2">&quot;Value&quot;</span><span class="p">:</span> <span class="s2">&quot;value1&quot;</span><span class="p">},</span>
<span class="lineno">11</span>     <span class="p">{</span><span class="s2">&quot;Key&quot;</span><span class="p">:</span> <span class="s2">&quot;key2&quot;</span><span class="p">,</span> <span class="s2">&quot;Value&quot;</span><span class="p">:</span> <span class="s2">&quot;value2&quot;</span><span class="p">}</span>
<span class="lineno">12</span>   <span class="o">]</span>
<span class="lineno">13</span> <span class="p">}</span></code></pre></div>

<p>WHAT THE HECK! Who in the world would think a key-value data-structure would
translate to an array where each key-value pair is it’s own object!? If that
makes any sense to you then, please, explain it to me. </p>

<p><br /></p>

<p><strong><em>Anti-Pattern #3</em></strong> - Provide an alternative method that provides the correct
functionality, give it a confusing name, and package it with a huge library so
that if you only need that one class then you’re screwed. </p>

<p>Come to find out, there is a correct implementation of a JSON serializer that is
called <em>JavaScriptSerializer</em> that lives in the System.Web DLL. Okay, if it’s
not confusing already that Microsoft is drawing a distinction between JSON and
JavaScript serialization, they make sure that if you want proper JSON 
serialization you have to include the <em>entire</em> System.Web DLL. Seriously!?</p>

<p>I’m just working on a simple utility project that will assist other
systems in our infrastructure. This project will be utilized by a variety
of project types. I can’t, in good conscience, force every project for carry
around a dependency of System.Web. So, off to the interwebs I go to find
another solution. </p>

<p><br />
…</p>

<p><br /></p>

<p>Okay, I’m back and I have a solution!
I’m going to rewrite the entire application in Ruby! Yep… That should do
the trick. </p>

<p><br /></p>

<p><strong><em>Anti-Pattern #4</em></strong> - Make fixing your dumb mistakes require a lot of
boiler-plate code that clutters up the user’s code-base.</p>

<p>Ah, if only it were that simple. What I really found on the webs
was how to write a wrapper-class to the built-in Dictionary class that would
serialize correctly. </p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="lineno"> 1</span> <span class="o">[</span><span class="no">Serializable</span><span class="o">]</span>
<span class="lineno"> 2</span> <span class="kp">public</span> <span class="k">class</span> <span class="nc">JsonDictionary</span><span class="o">&lt;</span><span class="n">K</span><span class="p">,</span> <span class="n">V</span><span class="o">&gt;</span> <span class="p">:</span> <span class="no">ISerializable</span>
<span class="lineno"> 3</span> <span class="p">{</span>
<span class="lineno"> 4</span>     <span class="no">Dictionary</span><span class="o">&lt;</span><span class="n">K</span><span class="p">,</span> <span class="n">V</span><span class="o">&gt;</span> <span class="n">dict</span> <span class="o">=</span> <span class="kp">new</span> <span class="no">Dictionary</span><span class="o">&lt;</span><span class="n">K</span><span class="p">,</span> <span class="n">V</span><span class="o">&gt;</span><span class="p">();</span>
<span class="lineno"> 5</span>  
<span class="lineno"> 6</span>     <span class="kp">public</span> <span class="no">JsonDictionary</span><span class="p">()</span> <span class="p">{</span> <span class="p">}</span> 
<span class="lineno"> 7</span>  
<span class="lineno"> 8</span>     <span class="kp">protected</span> <span class="no">JsonDictionary</span><span class="p">(</span><span class="no">SerializationInfo</span> <span class="n">info</span><span class="p">,</span> <span class="no">StreamingContext</span> <span class="n">context</span><span class="p">)</span>
<span class="lineno"> 9</span>     <span class="p">{</span>   
<span class="lineno">10</span>         <span class="kp">throw</span> <span class="kp">new</span> <span class="no">NotImplementedException</span><span class="p">();</span>
<span class="lineno">11</span>     <span class="p">}</span>   
<span class="lineno">12</span>  
<span class="lineno">13</span>     <span class="kp">public</span> <span class="n">void</span> <span class="no">GetObjectData</span><span class="p">(</span><span class="no">SerializationInfo</span> <span class="n">info</span><span class="p">,</span> <span class="no">StreamingContext</span> <span class="n">context</span><span class="p">)</span>
<span class="lineno">14</span>     <span class="p">{</span>   
<span class="lineno">15</span>         <span class="n">foreach</span> <span class="p">(</span><span class="n">K</span> <span class="n">key</span> <span class="k">in</span> <span class="n">dict</span><span class="o">.</span><span class="n">Keys</span><span class="p">)</span>
<span class="lineno">16</span>         <span class="p">{</span>   
<span class="lineno">17</span>             <span class="n">info</span><span class="o">.</span><span class="n">AddValue</span><span class="p">(</span><span class="n">key</span><span class="o">.</span><span class="n">ToString</span><span class="p">(),</span> <span class="n">dict</span><span class="o">[</span><span class="n">key</span><span class="o">]</span><span class="p">);</span>
<span class="lineno">18</span>         <span class="p">}</span>   
<span class="lineno">19</span>     <span class="p">}</span>   
<span class="lineno">20</span>  
<span class="lineno">21</span>     <span class="kp">public</span> <span class="n">void</span> <span class="no">Add</span><span class="p">(</span><span class="n">K</span> <span class="n">key</span><span class="p">,</span> <span class="n">V</span> <span class="n">value</span><span class="p">)</span>
<span class="lineno">22</span>     <span class="p">{</span>   
<span class="lineno">23</span>         <span class="n">dict</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">);</span>
<span class="lineno">24</span>     <span class="p">}</span>   
<span class="lineno">25</span>  
<span class="lineno">26</span>     <span class="kp">public</span> <span class="n">V</span> <span class="n">this</span><span class="o">[</span><span class="n">K</span> <span class="n">index</span><span class="o">]</span>
<span class="lineno">27</span>     <span class="p">{</span>   
<span class="lineno">28</span>         <span class="n">set</span> <span class="p">{</span> <span class="n">dict</span><span class="o">[</span><span class="n">index</span><span class="o">]</span> <span class="o">=</span> <span class="n">value</span><span class="p">;</span> <span class="p">}</span>
<span class="lineno">29</span>         <span class="n">get</span> <span class="p">{</span> <span class="k">return</span> <span class="n">dict</span><span class="o">[</span><span class="n">index</span><span class="o">]</span><span class="p">;</span> <span class="p">}</span>
<span class="lineno">30</span>     <span class="p">}</span>   
<span class="lineno">31</span> <span class="p">}</span></code></pre></div>

<p>This class just uses a Dictionary as the underlying data-store and serializes
correctly. The downside is that it really hides a lot of functionality that
is given by the built-in Dictionary type. One really useful feature it is
missing is the collections-constructor:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="lineno">1</span> <span class="n">var</span> <span class="n">dict</span> <span class="o">=</span> <span class="kp">new</span> <span class="no">Dictionary</span><span class="o">&lt;</span><span class="nb">String</span><span class="p">,</span> <span class="no">Int32</span><span class="o">&gt;</span>
<span class="lineno">2</span> <span class="p">{</span>
<span class="lineno">3</span>     <span class="p">{</span><span class="s2">&quot;one&quot;</span><span class="p">,</span>   <span class="mi">1</span> <span class="p">},</span>
<span class="lineno">4</span>     <span class="p">{</span><span class="s2">&quot;two&quot;</span><span class="p">,</span>   <span class="mi">2</span> <span class="p">},</span>
<span class="lineno">5</span>     <span class="p">{</span><span class="s2">&quot;three&quot;</span><span class="p">,</span> <span class="mi">3</span> <span class="p">},</span>
<span class="lineno">6</span>     <span class="sr">//</span> <span class="o">.</span><span class="n">.</span><span class="o">.</span>
<span class="lineno">7</span>     <span class="p">{</span><span class="s2">&quot;ten&quot;</span><span class="p">,</span>   <span class="mi">10</span><span class="p">}</span>
<span class="lineno">8</span> <span class="p">};</span></code></pre></div>

<p>Well, I just can’t do without those nicities. That’s an easy fix though, I
just need to be able to call a method, such as <em>ToJson()</em>, on a Dictionary
object.</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="lineno"> 1</span> <span class="kp">public</span> <span class="n">static</span> <span class="k">class</span> <span class="nc">IDictionaryExtension</span>
<span class="lineno"> 2</span> <span class="p">{</span>
<span class="lineno"> 3</span>     <span class="kp">public</span> <span class="n">static</span> <span class="no">JsonDictionary</span><span class="o">&lt;</span><span class="n">K</span><span class="p">,</span> <span class="n">V</span><span class="o">&gt;</span> <span class="no">ToJsonDictionary</span><span class="o">&lt;</span><span class="n">K</span><span class="p">,</span><span class="n">V</span><span class="o">&gt;</span><span class="p">(</span><span class="n">this</span> <span class="no">IDictionary</span><span class="o">&lt;</span><span class="n">K</span><span class="p">,</span> <span class="n">V</span><span class="o">&gt;</span> <span class="n">dict</span><span class="p">)</span>
<span class="lineno"> 4</span>     <span class="p">{</span>   
<span class="lineno"> 5</span>         <span class="k">if</span> <span class="p">(</span><span class="n">dict</span> <span class="o">==</span> <span class="n">null</span><span class="p">)</span>
<span class="lineno"> 6</span>             <span class="k">return</span> <span class="n">null</span><span class="p">;</span>
<span class="lineno"> 7</span>         <span class="n">var</span> <span class="n">jsonDict</span> <span class="o">=</span> <span class="kp">new</span> <span class="no">JsonDictionary</span><span class="o">&lt;</span><span class="n">K</span><span class="p">,</span> <span class="n">V</span><span class="o">&gt;</span><span class="p">();</span>
<span class="lineno"> 8</span>         <span class="n">foreach</span> <span class="p">(</span><span class="n">var</span> <span class="n">key</span> <span class="k">in</span> <span class="n">dict</span><span class="o">.</span><span class="n">Keys</span><span class="p">)</span>
<span class="lineno"> 9</span>         <span class="p">{</span>   
<span class="lineno">10</span>             <span class="n">jsonDict</span><span class="o">[</span><span class="n">key</span><span class="o">]</span> <span class="o">=</span> <span class="n">dict</span><span class="o">[</span><span class="n">key</span><span class="o">]</span><span class="p">;</span>
<span class="lineno">11</span>         <span class="p">}</span>   
<span class="lineno">12</span>         <span class="k">return</span> <span class="n">jsonDict</span><span class="p">;</span>
<span class="lineno">13</span>     <span class="p">}</span>                                                                                                                                                                            
<span class="lineno">14</span> <span class="p">}</span></code></pre></div>

<p>There we go, now I can just call <em>ToJsonDictionary()</em> on any IDictionary
object right before serializing to JSON. Finally, we have working serialization!</p>

<h4 id="step-3---send-json-via-http-post">Step 3 - Send JSON via HTTP POST</h4>

<p>In terms of length and complexity, sending a request isn’t too cumbersome of a 
process. Assuming that we have already serialized the JSON into a Stream
object, sending our request looks like the following:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="lineno">1</span> <span class="no">WebRequest</span> <span class="n">request</span> <span class="o">=</span> <span class="no">WebRequest</span><span class="o">.</span><span class="n">Create</span><span class="p">(</span><span class="no">NSUrl</span><span class="p">);</span>
<span class="lineno">2</span> <span class="n">request</span><span class="o">.</span><span class="n">Method</span> <span class="o">=</span> <span class="s2">&quot;POST&quot;</span><span class="p">;</span>
<span class="lineno">3</span> <span class="n">request</span><span class="o">.</span><span class="n">ContentLength</span> <span class="o">=</span> <span class="n">jsonStream</span><span class="o">.</span><span class="n">Length</span><span class="p">;</span>
<span class="lineno">4</span> <span class="n">request</span><span class="o">.</span><span class="n">ContentType</span> <span class="o">=</span> <span class="s2">&quot;application/json&quot;</span><span class="p">;</span>
<span class="lineno">5</span> <span class="no">Stream</span> <span class="n">requestStream</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">GetRequestStream</span><span class="p">();</span>
<span class="lineno">6</span> <span class="n">requestStream</span><span class="o">.</span><span class="n">Write</span><span class="p">(</span><span class="n">jsonStream</span><span class="o">.</span><span class="n">ToArray</span><span class="p">(),</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">int</span><span class="p">)</span><span class="n">jsonStream</span><span class="o">.</span><span class="n">Length</span><span class="p">);</span>
<span class="lineno">7</span> <span class="n">requestStream</span><span class="o">.</span><span class="n">Close</span><span class="p">();</span></code></pre></div>

<p>If we look back at the Ruby example above, you’ll notice that almost all of the
code is focusing on sending the request. So, as far as sending web-requests is
concerned, the .NET version is comparable in terms of length. </p>

<p>However, one thing to think about—when is the request sent? Well, in this case,
it wasn’t. Yep, you read correctly, the request in the above example was never
made. You might say, <em>“Of course it never sent, you obviously have to call some
type of Send() method or something similar.”</em> Well, that would be the
<em>sensible</em> thing to do now wouldn’t it.</p>

<p><br /></p>

<p><strong><em>Anti-Pattern #5</em></strong> - Implicit is better than explicit (especially when it
is non-obvious)</p>

<p>The request is sent when you ask for the response. Yes, that does make sense
if I am interested in the response. However, if I just want to “send and
forget” then you would use the following to make the request:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="lineno">1</span> <span class="sr">//</span> <span class="no">Build</span> <span class="n">up</span> <span class="n">request</span>
<span class="lineno">2</span> <span class="sr">//</span> <span class="o">.</span><span class="n">.</span><span class="o">.</span>
<span class="lineno">3</span>  
<span class="lineno">4</span> <span class="sr">//</span> <span class="no">Send</span> <span class="n">request</span>
<span class="lineno">5</span> <span class="n">request</span><span class="o">.</span><span class="n">GetResponse</span><span class="p">();</span></code></pre></div>

<p>Sure… that’s real intuitive. </p>

<h4 id="step-4---verify-the-response-status-code">Step 4 - Verify the response status code</h4>

<p>Finally! We’ve made sense of the .NET framework (oxymoron?) and can finally
verify the reponse status code. This part is so simple, it’d be a real challenge
to screw this one up. It is simply:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="lineno">1</span> <span class="no">HttpWebResponse</span> <span class="n">response</span> <span class="o">=</span> <span class="p">(</span><span class="no">HttpWebResponse</span><span class="p">)</span><span class="n">request</span><span class="o">.</span><span class="n">GetResponse</span><span class="p">();</span>
<span class="lineno">2</span> <span class="n">var</span> <span class="n">statusCode</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">StatusCode</span><span class="p">;</span>
<span class="lineno">3</span>  
<span class="lineno">4</span> <span class="k">return</span> <span class="n">statusCode</span> <span class="o">==</span> <span class="no">HttpStatusCode</span><span class="o">.</span><span class="n">OK</span><span class="p">;</span></code></pre></div>

<p><br />
<br /></p>

<h3 id="closing-thoughts">Closing Thoughts</h3>
<p>Holy crap Microsoft…</p>

  </article>

</div>

      </div>
    </div>


    <!-- Google Analytics -->
    <script type="application/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-11511983-4']);
      _gaq.push(['_trackPageview']);
      (function() {
        var ga = document.createElement('script'); 
        ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'stats.g.doubleclick.net/dc.js';
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(ga, s);
      })();
    </script>
  </body>

</html>
